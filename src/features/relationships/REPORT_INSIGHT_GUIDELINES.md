# 🧠 Antigravity: 정기 진단 리포트 인사이트 엔진 가이드

정기 진단 리포트(`RelationshipReport`)의 인사이트 영역은 **'지능형 시멘틱 템플릿 엔진(Intelligent Semantic Template Engine)'**을 통해 생성됩니다. 이 엔진은 관계의 고정적 성격(RQS), 동적 위상(Orbit Zone), 최근 행위(Timeline) 데이터를 조합하여 수천 가지의 개인화된 서사를 만들어냅니다.

---

## 🏗️ 3단계 서사 구조 (Narrative Structure)

인사이트는 아래의 3가지 조각(Segment)을 논리적으로 결합하여 하나의 완성된 진단 및 처방으로 구성됩니다.

### Part 1. 상태 진단 (RQS Grade 기반)
*관계의 본질적인 성격과 캐릭터 타입을 정의합니다.*

| 등급 | 매칭 키워드 | 문구 풀 (Narrative Pool) |
| :--- | :--- | :--- |
| **S (Soul Anchor)** | 가장 소중한 존재 | • 이 사람은 당신의 삶에 가장 단단한 뿌리가 되어주는 존재입니다.<br>• 서로의 영혼이 맞닿은 안전 기지와 같은 소중한 관계군요.<br>• 당신이 어떤 풍파를 겪어도 돌아올 수 있는 든든한 안식처입니다. |
| **A (Vision Mirror)** | 건강한 조력자 | • 함께 성장하기에 더할 나위 없는 이상적인 파트너십을 유지하고 있습니다.<br>• 서로에게 긍정적인 영감을 주는 건강한 정서적 조력 관계입니다.<br>• 안정적인 신뢰를 바탕으로 서로의 자아상을 강화해주고 있습니다. |
| **B (Neutral)** | 중립적 교류 | • 적절한 사회적 거리를 유연하게 관리하고 있는 중립적 상태입니다.<br>• 큰 갈등은 없으나, 관계의 깊이를 더하기 위한 새로운 모멘텀이 필요한 시기입니다.<br>• 에너지 소모를 최소화하며 담백한 관계의 흐름을 보여주고 있습니다. |
| **C (Vampire)** | 에너지 소모 | • 현재 심리적 에너지 소모가 상당히 큰 'Vampire' 징후가 보입니다.<br>• 정서적 경계가 무너지며 당신의 회복탄력성을 저해할 위험이 있는 단계입니다.<br>• 관계의 궤도를 전면적으로 재검토하고 에너지를 보호해야 할 시점입니다. |

### Part 2. 정서 맥락 분석 (Timeline Trend 기반)
*최근 3회 간의 상호작용 데이터(온도, 코르티솔)를 통해 현재의 분위기를 분석합니다.*

| 조건 | 상태 분류 | 분석 문구 (Analysis) |
| :--- | :--- | :--- |
| **코르티솔 발생** | **DANGER** | • 최근 상호작용에서 코르티솔(스트레스) 수치가 위험 수준으로 관찰되었습니다.<br>• 상대방과의 대화에서 발생하는 정서적 마찰이 당신의 에너지를 고갈시키고 있습니다.<br>• 반복되는 부정적 패턴이 관계의 기초 체력을 저하시키고 있는 상태입니다. |
| **온도 60° 이상** | **WARM** | • 최근의 따뜻한 교감이 관계의 신뢰 자본을 더욱 두텁게 만들었습니다.<br>• 공유된 긍정적 정서가 강력한 유대감을 형성하여 안정성을 높여주고 있네요.<br>• 최근 상호작용에서 발생한 정서적 공명이 관계의 면역력을 높였습니다. |
| **온도 60° 미만** | **COLD** | • 최근 정서적 개입이 줄어들며 관계가 다소 건조해진 상태로 감지됩니다.<br>• 익숙함 속에 가려져 서로의 온도를 살피는 데 소홀해진 시기가 아닌지 점검이 필요합니다.<br>• 구조적 안정감은 있으나 감정적 연결고리가 느슨해져 정서적 가뭄에 대비해야 합니다. |

### Part 3. 행동 처방 (Orbit Zone 기반)
*관계의 위상(Zone)에 따라 이번 주에 권장되는 구체적인 행동 지침입니다.*

| 대상 레이어 | 처방 방향 | 액션 플랜 (Action Plan) |
| :--- | :--- | :--- |
| **Zone 1 ~ 2** (핵심 관계) | 정서적 보답 | • 이번 주에는 **당연하다고 여겼던 진심**을 꺼내 전해 보세요.<br>• 상대방의 안정감이 당신에게 큰 힘이 되고 있음을 **구체적인 행동**으로 보답해볼 시간입니다.<br>• 깊은 신뢰를 바탕으로 한 **질적 대화**를 통해 정서적 온도를 높여 보시길 추천합니다. |
| **Zone 3 ~ 4** (전략/지인) | 에너지 보호 | • 지나친 에너지 몰입보다는 **건강한 거리감**을 유지하며 자신의 내면에 집중할 시기입니다.<br>• 상대방의 과도한 요구에 휩쓸리지 않도록 **심리적 바운더리**를 명확히 세우는 연습이 필요합니다.<br>• 이번 주에는 무리한 약속보다는 **가벼운 안부** 정도로만 접촉하며 에너지를 비축하세요. |

---

3.  **동적 결합**: 선택된 조각들을 결합하여 최종 결과물을 렌더링합니다. (`Part 1 + Part 2` → Diagnosis, `Part 3` → Action Plan)

---

## 📊 최근 6개월 변화 차트 로직 (Trend Chart Logic)

리포트 하단의 바 차트는 사용자의 실제 히스토리 데이터를 기반으로 관계의 장기적 추이를 계산합니다.

### 1. 시계열 데이터 가공
*   **시간 축**: 현재 시점을 기준으로 과거 6개월 데이터를 월별로 그룹화합니다.
*   **데이터 필터링**: `node.history` 데이터 중 해당 연도/월에 일치하는 기록만 추출합니다.

### 2. 월별 스코어 산출 알고리즘
각 월의 막대 높이는 다음 가중치 모델을 따릅니다:
*   **RQS 기본 점수 (70%)**: 관계의 본질적인 성격 부합도.
*   **월간 평균 온도 (20%)**: 해당 월에 발생한 상호작용의 정서적 따뜻함.
*   **상호작용 빈도 보너스 (10%)**: 접촉 횟수에 따른 가산점 (최대 10점).

### 3. 데이터 부재 시 처리
*   기록이 없는 달은 관계의 기본 등급을 유지하되, 시각적 자연스러움을 위해 약간의 변동폭(Variance)을 주어 '유지/조정' 상태로 표시합니다.

---

## 🎯 종합 관계 스코어 산출 근거 (Score Basis)

사용자에게 제공되는 모든 수치는 **'성질(Character) x 위상(Orbit) x 행위(Action)'**의 3축 시스템에 의해 결정됩니다.

1.  **본질적 성질 (RQS)**: 성격 진단(RQS TEST)을 통해 정의된 관계의 근본적인 체력과 등급.
2.  **위상 레이어 (Orbit Zone)**: 현재 이 사람이 나의 심리적 궤도 중 어느 레이어(Zone 1~5)에 위치해 있는지에 따른 기대 에너지.
3.  **정서적 행위 (Timeline)**: 타임라인에 기록된 최근의 정서 농도(온도), 빈도, 그리고 신체화 지표(옥시토신/코르티솔).

---

## ⚙️ 선택 알고리즘 (Selection Logic)

1.  **결정론적 분류**: 데이터(Grade, Zone, Timeline Stats)에 따라 위 표의 각 카테고리 풀(Pool)을 먼저 확정합니다.
2.  **Seeded Random**: `relationshipId`를 시드값으로 사용하여 풀 내의 인덱스를 무작위로 선택합니다.
    *   **이유**: 같은 날, 같은 데이터더라도 대상 인물마다 다른 느낌의 문장을 제공하여 '나만의 리포트'라는 느낌을 강화하기 위함입니다. 데이터가 변하지 않는 한 문장은 고정됩니다.
3.  **동적 결합**: 선택된 조각들을 결합하여 최종 결과물을 렌더링합니다. (`Part 1 + Part 2` → Diagnosis, `Part 3` → Action Plan)

---

## 📝 가이드라인 준수 사항 (Writing Principles)

1.  **제3자 관점**: 분석의 주체는 항상 분석 대상인 '이 사람' 혹은 '상대방'이어야 합니다. ('당신'은 분석 리포트를 읽는 주체로 한정)
2.  **데이터 근거**: 보이지 않는 곳에서 데이터를 계측하되, 문구에서는 그 데이터가 주는 '의미'를 심리학적으로 해석하여 전달합니다.
3.  **실천 가능성**: 액션 플랜은 모호한 조언보다 이번 주 내에 즉시 실행 가능한 행동 단위로 제안합니다.

---

## ⚠️ 기술 보안 지침 (Markup Rules) - **중요**

인사이트 문구 내에서 특정 단어를 강조하거나 스타일을 입힐 때 아래 규칙을 반드시 준수해야 합니다.

*   **JSX 코드 삽입 금지**: 문구 내에 직접적인 `<Text>` 태그나 스타일 개체를 절대 삽입하지 마십시오. 이는 렌더링 오류의 원인이 됩니다.
*   **대괄호(`[]`) 마크업 사용**: 강조가 필요한 키워드는 `[강조할 텍스트]`와 같이 대괄호로 감싸십시오. 
    *   *예시: "이번 주에는 [질적 대화]를 시도해보세요."*
*   **자동 스타일링**: 엔진 내의 `renderActionPlan` 함수가 대괄호를 감지하여 앱의 테마(`accent color`)와 볼드 처리를 자동으로 적용합니다.
